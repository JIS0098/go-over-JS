<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
    integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="main.css" />
</head>

<body style="background-color: #f4f4f4">
  <nav class="nav">
    <a class="nav-link active" aria-current="page" href="#">집꾸미기</a>
    <a class="nav-link" href="#">Home</a>
    <a class="nav-link" href="#">스토어</a>
    <a class="nav-link" href="#">시공견적</a>
  </nav>

  <div class="container">
    <input class="search" type="text" placeholder="검색어 입력" />
  </div>

  <div id="container">
    <div class="row product-list"></div>
  </div>

  <div class="container" style="background-color: lightgrey; padding: 20px; margin-top: 20px">
    <h4>장바구니</h4>
    <div class="row cart">
      <p style="color: white;">여기로 드래그</p>
    </div>


    <script>
      let 눌렀던거;
      $(".nav a").on("click", (e) => {
        $(e.target).css("color", "white");
        $(눌렀던거).css("color", "gray");
        눌렀던거 = e.target;
      });

      $.get("store.json").done((data) => {
        var productList = data.products;

        //불러온 상품api로 카드만들기
        productList.forEach((product) => {
          $('.product-list').append(
            `<div class="col-md-3">
             <div class="item" draggable="true" data-id="${product.id}">
              <img src="${product.photo}"/>
              <h4>${product.title}</h4>
              <p>${product.brand}</p>
              <p>가격 : ${product.price}</p>
              <button class="add" data-id="${product.id}">담기</button>
             </div>
            </div>`
          )
        });



        // 장바구니가 비워져있고

        // 만약 버튼눌렀을때 장바구니에 아이디가 같은 상품이 없으면  장바구니에 제품html을 추가시키고 
        // 있으면 숫자창의 숫자가 +1이 된다 

        // 만약 버튼을 누르지 않고 
        // 드래그를 했을때 장바구니에 아이디가 같은 상품이 없으면  장바구니에 제품html을 추가시키고 
        // 있으면 숫자창의 숫자가 +1이 된다 
        $('.item').on('dragstart', (e) => {
          e.originalEvent.dataTransfer.setData('product', e.currentTarget.dataset.id);
        })

        $('.cart').on('drop', (e) => {
          var data = e.originalEvent.dataTransfer.getData('product')
          console.log(data)

          var cartProduct = productList.filter((product) => {
            return product.id == data
          })
          cartProduct.forEach((product) => {
            $('.cart').append(
              `<div class="col-md-3" >
             <div class="cart-item" draggable="true" data-id="${product.id}">
              <img src="${product.photo}"/>
              <h4>${product.title}</h4>
              <p>${product.brand}</p>
              <p>가격 : ${product.price}</p>
              <input type="text" value="1">
             </div>
            </div>`
            )
          });
        })

        $('.cart').on('dragover', (e) => {
          e.preventDefault()
        })

        //검색기능
        $(".search").on('input', () => {
          var 검색어 = $('.search').val();
          $('.product-list').html('');

          var arr = productList.filter((product) => {
            return product.title.includes(검색어) || product.brand.includes(검색어)
          })
          arr.forEach((product) => {
            $('.product-list').append(
              `<div class="col-md-3">
             <div class="item" draggable="true" data-id="${product.id}">
              <img src="${product.photo}"/>
              <h4>${product.title}</h4>
              <p>${product.brand}</p>
              <p>가격 : ${product.price}</p>
              <button class="add" data-id="${product.id}">담기</button>
             </div>
            </div>`
            )
          });
          $('.product-list h4').each((i, h4) => {
            var title = h4.innerHTML
            console.log(title)
            title = title.replace(검색어, `<span style="background : yellow">${검색어}</span>`)
            h4.innerHTML = title
          })
        });
      })
    </script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"></script>
</body>

</html>

<!-- productCard = `<div id="product-container">
    <div class="card">
        <img style="width:100%;" src="${product.photo}">
        <h5 style="margin-top:20px; margin-bottom:0px; font-weight: 700;">${product.title}</h5>
        <p>${product.brand}</p>
        <p style=" font-size: 19px;  font-weight: 500;">가격 : ${product.price}</p>
        <button type="button" style=" width: 60px;" class="btn btn-dark">담기</button>
    </div>
</div>`;
$("#product-container").html(productCard); -->